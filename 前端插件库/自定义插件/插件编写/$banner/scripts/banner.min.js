;(function($,window){$.fn.addBanner=function(options){var opts=$.extend({},$.fn.addBanner.defaultOpts,options||{});$(this).each(function(){var $that=$(this);var conBox=opts.contentBox!=null?$that.find(opts.contentBox):$that.children("ul:first-child");var navBox=opts.navigationBox!=null?$that.find(opts.navigationBox):$that.children('ul:last-child');var navList=navBox.children();var conList=conBox.children();var $prev=opts.handlePrev!=null?$(this).find(opts.handlePrev):opts.handlePrev;var $next=opts.handleNext!=null?$(this).find(opts.handleNext):opts.handleNext;var curIndex=oldIndex=opts.index;var timer=null,effectFn=null;var isMoving=false;var flag=false;var size=navList.length;var itemSize=opts.isVertical?Math.ceil(conList.eq(0).innerHeight()):Math.ceil(conList.eq(0).innerWidth());opts.isFullScreen?conList.css({width:$(window).width()}):""
if(opts.isFullScreen){if(!opts.isVertical){$(window).bind("resize",function(){switch(opts.effect){case"twin":itemSize=$(window).width();conList.css({'left':itemSize,'width':itemSize}).eq(curIndex).css('left',0);conBox.css({"width":itemSize});break;case"order":itemSize=$(window).width();conList.width(itemSize);conBox.css({"width":itemSize*size});if(isMoving){conBox.stop(true,true);effectFn();}else{effectFn();};break;default:return;};});}else{};};$prev!=null?$prev.bind("click",function(){switch(opts.effect){case"twin":var newIndex=((curIndex)-1<0)?size-1:curIndex-1;if(isMoving||conList.is(":animated")){return;}
oldIndex=curIndex;curIndex=newIndex;setClass(curIndex);changeTwinPrevious();break;default:var newIndex=((curIndex)-1<0)?size-1:curIndex-1;navList.eq(newIndex).trigger(opts.mouseType);return;};}):"";$next!=null?$next.bind("click",function(){switch(opts.effect){case"twin":var newIndex=((curIndex+1)>=size)?0:curIndex+1;if(isMoving||conList.is(":animated")){return;}
oldIndex=curIndex;curIndex=newIndex;setClass(curIndex);changeTwinNext();break;default:var newIndex=((curIndex+1)>=size)?0:curIndex+1;navList.eq(newIndex).trigger(opts.mouseType);return;};}):"";navList.each(function(i){var index=i;$(this).bind(opts.mouseType,function(e){if(index==curIndex){return;}
if(isMoving||conBox.is(":animated")){return;}
oldIndex=curIndex;curIndex=index;setClass(curIndex);effectFn();e.preventDefault();});});function setClass(index){var $that=navList.eq(index);if(opts.classType=='only'){$that.addClass(opts.selectedClass).siblings().removeClass(opts.selectedClass);}else{$that.addClass(opts.selectedClass+String(curIndex+1)).siblings().removeClass((opts.selectedClass+String(oldIndex+1)));}}
setClass(opts.index);function autoTimer(){if(!opts.autoPlay){return;}
if(timer){clearInterval(timer);}
timer=setInterval(autoPlay,opts.delay);}
function stopTimer(){clearInterval(timer);}
function autoPlay(){var newIndex=((curIndex+1)>=size)?0:curIndex+1;switch(opts.effect){case"twin":oldIndex=curIndex;curIndex=newIndex;setClass(curIndex);changeTwinNext();break;default:navList.eq(newIndex).trigger(opts.mouseType);}}
switch(opts.effect){case"fade":conList.css({'position':'absolute','left':0,'top':0}).hide().eq(curIndex).show();effectFn=changeFade;break;case"minMove":conBox.css({'position':'relative'});conList.css({position:"absolute",'left':opts.distance,'opacity':0}).eq(opts.index).css({'left':0,'opacity':1});effectFn=changeMinMove;break;case"twin":if(opts.isVertical){conList.css({'position':'absolute','top':0,'top':itemSize,'height':itemSize}).eq(curIndex).css('top',0);effectFn=changeTwinV;}else{conList.css({'position':'absolute','top':0,'left':itemSize,'width':itemSize}).eq(curIndex).css('left',0);effectFn=changeTwinH;}
break;case"order":if(opts.isVertical){conBox.css({'position':'relative','height':size*itemSize});effectFn=changeOrderV;}else{conBox.css({'position':'relative','width':size*itemSize});conList.css("float","left");effectFn=changeOrderH;}
break;case"back":effectFn=changeCallback;break;}
function changeFade(){conList.eq(curIndex).css({"z-index":"999"}).stop(true,true).fadeIn(opts.tweenTime,opts.ease).siblings().css("z-index","0").fadeOut(opts.tweenTime+200,opts.ease);opts.callBack!=null?changeCallback(curIndex):"";}
function changeMinMove(index){isMoving=true;conList.eq(oldIndex).animate({"left":opts.distance,'opacity':0},opts.time,function(){isMoving=false;}).end().eq(curIndex).animate({"left":0,'opacity':1},opts.time,function(){isMoving=false;});}
function changeTwinH(){isMoving=true;var pos=(curIndex>oldIndex)?itemSize:-itemSize;conList.eq(curIndex).css('left',pos).animate({"left":0},opts.tweenTime).end().eq(oldIndex).animate({"left":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}
function changeTwinV(){isMoving=true;var pos=(curIndex>oldIndex)?itemSize:-itemSize;conList.eq(curIndex).css('top',pos).animate({"top":0},opts.tweenTime).end().eq(oldIndex).animate({"top":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}
function changeTwinPrevious(){isMoving=true;if(!opts.isVertical){var pos=-itemSize
conList.eq(curIndex).css('left',pos).animate({"left":0},opts.tweenTime).end().eq(oldIndex).animate({"left":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}else{var pos=-itemSize
conList.eq(curIndex).css('top',pos).animate({"top":0},opts.tweenTime).end().eq(oldIndex).animate({"top":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";};};function changeTwinNext(){if(!opts.isVertical){isMoving=true;var pos=itemSize;conList.eq(curIndex).css('left',pos).animate({"left":0},opts.tweenTime).end().eq(oldIndex).animate({"left":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}else{isMoving=true;var pos=itemSize;conList.eq(curIndex).css('top',pos).animate({"top":0},opts.tweenTime).end().eq(oldIndex).animate({"top":-pos},opts.tweenTime,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";};};function changeOrderV(){isMoving=true;conBox.stop(true,true).animate({'top':-curIndex*itemSize},opts.tweenTime,opts.ease,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}
function changeOrderH(){isMoving=true;conBox.stop(true,true).animate({'left':-curIndex*itemSize},opts.tweenTime,opts.ease,function(){isMoving=false;});opts.callBack!=null?changeCallback(curIndex):"";}
function changeCallback(){if(opts.callBack!=null){opts.callBack(curIndex);}}
function showHandle(){flag=true;$that.find(opts.handleContain).animate({opacity:1},opts.tweenTime,function(){flag=false;});}
function hideHandle(){$that.find(opts.handleContain).animate({opacity:0},opts.tweenTime);}
autoTimer();$(this).hover(function(){stopTimer();if(opts.handleContain!=null){if(flag){return;}else{showHandle()}}},function(){autoTimer();if(opts.handleContain!=null){hideHandle()}}).trigger("mouseout");});}
$.fn.addBanner.defaultOpts={effect:"order",index:0,selectedClass:"on",classType:"only",mouseType:"click",tweenTime:600,delay:6000,autoPlay:false,contentBox:null,navigationBox:null,handleContain:null,handlePrev:null,handleNext:null,ease:"swing",distance:-50,isVertical:false,isFullScreen:false,callBack:null};})(jQuery,window);