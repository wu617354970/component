$(function(){(function(){var lastTime=0;var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(!window.requestAnimationFrame)
window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window.cancelAnimationFrame)
window.cancelAnimationFrame=function(id){clearTimeout(id);};})();$.fn.addShine=function(options){var defaultOptions={totalCount:1000,tweetime:1000,progresssBar:".fd_progresss_bar",shine:".fd_shine",getCount:".fd_get_count",getAddCount:".fd_add_count",callBack:null}
return this.each(function(){var opts=$.fn.extend({},defaultOptions,{totalCount:$(this).find(".fd_progresss_bar").data('totalCount'),currentCount:$(this).find(".fd_progresss_bar").data('currentCount'),updateCount:$(this).find(".fd_progresss_bar").data('updateCount'),},options||{});var _this=this,_that=$(this),_dataElement=_that.find(opts.progresssBar),_shine=_that.find(opts.shine),_getCount=_that.find(opts.getCount),_getAddCount=_that.find(opts.getAddCount),_totalCount=opts.totalCount,_currentCount=opts.currentCount,_updateCount=opts.updateCount,_addCount=0,_percentCurrent=0
_percent=0;_getAddCount.css({position:"relative","z-index":2,top:0});function animloop(){_this.animId=window.requestAnimationFrame(animloop);render()}
function stopAnimate(){window.cancelAnimationFrame(_this.animId);}
function initial(){_percentCurrent=_currentCount/_totalCount*100;_dataElement.animate({width:_percentCurrent+"%"},opts.tweetime,"easeInCirc",function(){_getCount.text(_currentCount);_getAddCount.text("").css({top:"50px"});animloop();});}
function render(){updateCount=_dataElement.data('updateCount');if(updateCount==_currentCount){return;}else{_addCount=updateCount-_currentCount;_percentCurrent=_currentCount/_totalCount*100;_currentCount=updateCount;_percent=Math.min(100,_currentCount/_totalCount*100)+"%";_shine.show().animate({left:_percent},{step:function(now,fx){if(now>_percentCurrent){_dataElement.css({width:now+"%"});}},duration:opts.tweetime,specialEasing:{left:"easeInCirc"},complete:function(){_shine.hide().css({left:0});_getCount.text(_currentCount);_getAddCount.text("+"+_addCount).animate({top:"0px"},opts.tweetime/2,"easeInQuad").delay(opts.tweetime/2).animate({top:"-50px"},opts.tweetime/2,"easeInQuad",function(){_getAddCount.text("").css({top:"50px"});});if(opts.callBack!==null&&typeof opts.callBack=="function"){opts.callBack();}},fail:function(){},always:function(){}});}};initial();});}});