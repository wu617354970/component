/**
 * @author wuwg
 * @version 2016.0.1
 * @description file
 * @createTime 2016/7/13
 * @updateTime 2016/7/13
 * @descrition  兼容ie8+
 */
!function(a,b){b.fn.autocompleter=function(a){var e,c=b(this),d={};return d._this=c,e={showLog:!1,hasSearchButton:!1,searchButton:".fd-btn-search",autocompleterContain:"fd-menu-contain",searchName:["fyjc","xqmc","fyjb","isXq","fbdm","mapId"],limitCount:5,deferTime:200,autocompleter:!0,menuSelectedClass:"selected",hideAutocompleterClass:"hide",data:[],autocompleterIsAjax:!1,autocompleterAjax:{url:"../json/data.json",method:"get",data:"query",dataType:"json",asych:!0,success:function(a,b,c,d){console.log("ajax成功"),d.autocompleter.response=a.data.dataList},error:function(){console.log("ajax失败")}},callback:{search:function(a,c){var d=[];b.each(c._this.data(),function(a,b){d.push("<p>"+a+":"+b+"</p>")}),b("#jsContent").html(d.join(""))}}},d.opts=b.fn.extend(!0,{},e,a||{}),d._this.parent().append('<div class="'+d.opts.autocompleterContain+" "+d.opts.hideAutocompleterClass+'"></div>'),d.autocompleterContain=d._this.siblings("."+d.opts.autocompleterContain),d.opts.hasSearchButton&&(d.searchButton=d._this.siblings(d.opts.searchButton)),d.autocompleter={timer:null,response:[],copyValueToSearch:function(a){var b,c,e;b=a?a:d.autocompleterContain.find("."+d.opts.menuSelectedClass),b.size()>0&&(c=b.data(),d._this.removeData(),d._this.data(c),e=b.text(),d._this.val(e),d.autocompleter.hideAutocompleter())},hideAutocompleter:function(){b(d.autocompleterContain).addClass(d.opts.hideAutocompleterClass)},showAutocompleter:function(){b(d.autocompleterContain).removeClass(d.opts.hideAutocompleterClass)},queryValue:"",query:function(a,c,e,f,g,h){var j,k,l,m,n,o;if(f)d.opts.showLog&&(console.log("发送到后台的数据是："),console.log({param:JSON.parse('{"'+d.opts.autocompleterAjax.data+'":"'+a+'"}')}),console.log("\n")),b.ajax({url:d.opts.autocompleterAjax.url,method:d.opts.autocompleterAjax.method,dataType:d.opts.autocompleterAjax.dataType,data:{param:'{"'+d.opts.autocompleterAjax.data+'":"'+a+'"}'},success:function(c,f,i){d.opts.showLog&&(console.log("后台返回的数据是："),console.log(c),console.log("\n")),"function"===b.type(d.opts.autocompleterAjax.success)&&d.opts.autocompleterAjax.success(c,f,i,d),d.autocompleter.response.length>0?d.autocompleter.response.length>e&&(d.autocompleter.response=d.autocompleter.response.slice(0,e)):d.autocompleter.response=[],g&&d.autocompleter.makeList(a),"function"===b.type(h)&&h(a,d)},error:function(a,c,e){"function"===b.type(d.opts.autocompleterAjax.error)&&d.opts.autocompleterAjax.error(a,c,e,d)}});else{for(c=c,e=e,j=0,k=c.length;k>j;j++){for(l=c[j],m="",n=0,o=d.opts.searchName.length;o>n;n++)if(l[d.opts.searchName[n]]&&(m=d.opts.searchName[n],-1!==l[m].search(a))){d.autocompleter.response.push(l);break}if(d.autocompleter.response.length>=e)break}g&&d.autocompleter.makeList(a),"function"===b.type(h)&&h(a,d)}},makeList:function(a){var c,e,f,g,h,i,j,k,b=d.autocompleter.response.length;if(b>0){for(c=['<ul class="fd-search-menu">'],e=0;b>e;e++){f=d.autocompleter.response[e],g=[];for(k in f)k!==d.opts.childKey&&(""===f[k]&&(f[k]="false"),g.push("data-"+k+"="+f[k]));for(g=g.join(" "),h="",i=0,j=d.opts.searchName.length;j>i;i++)if(f[d.opts.searchName[i]]&&(h=d.opts.searchName[i],-1!==f[h].search(a))){d.autocompleter.response.push(f);break}k=f[h].split(a).join("<em>"+a+"</em>"),c.push('<li  class="fd-item" '+g+">"+k+"</li>")}c.push("</ul>"),d.autocompleterContain[0].innerHTML=c.join(""),d.autocompleterContain.removeClass(d.opts.hideAutocompleterClass),d.opts.autocompleter||d.autocompleterContain.addClass(d.opts.hideAutocompleterClass)}else d.autocompleterContain.html('<div class="fd-empty-contain">未找到符合条件的数据</div>').removeClass(d.opts.hideAutocompleterClass),d._this.removeData(),d.opts.autocompleter||d.autocompleterContain.addClass(d.opts.hideAutocompleterClass)},ignoredKeyCod:[9,13,17,19,20,27,33,34,35,36,37,39,44,92,113,114,115,118,119,120,122,123,144,145],bindEvent:function(){d._this.off("keydown.autocompleter").on("keydown.autocompleter",d.autocompleter.keydown),d._this.off("keyup.autocompleter").on("keyup.autocompleter",d.autocompleter.keyup),d._this.off("focus.autocompleter").on("focus.autocompleter",d.autocompleter.focus),d._this.off("blur.autocompleter").on("blur.autocompleter",d.autocompleter.blur),d.autocompleterContain.off("mousedown.autocompleter").on("mousedown.autocompleter","li",d.autocompleter.mousedown)},keydown:function(a){var b=a.keyCode?a.keyCode:a.which;a.data,40===b||38===b?(a.preventDefault(),a.stopPropagation()):39===b||13===b&&(a.preventDefault(),a.stopPropagation())},search:function(){d.autocompleter.queryValue=b.trim(d._this.val()),""!==d.autocompleter.queryValue?(d.autocompleter.response=[],d.autocompleter.query(d.autocompleter.queryValue,d.opts.data,d.opts.limitCount,d.opts.autocompleterIsAjax,!0)):b(d.autocompleterContain).hasClass(d.opts.hideAutocompleterClass)||d.autocompleter.hideAutocompleter()},focus:function(){d.autocompleter.search(),d._this.removeData()},blur:function(){d.autocompleter.hideAutocompleter()},keyup:function(a){var e,f,g;if(a.data,e=a.keyCode?a.keyCode:a.which,40===e||38===e){if(b(d.autocompleterContain).hasClass(d.opts.hideAutocompleterClass)||b(d.autocompleterContain).find("ul").size()<1)return;f=-1,g=d.autocompleterContain.find("."+d.opts.menuSelectedClass),g.size()>0&&(f=g.index()),40==e?(f++,f>=d.autocompleter.response.length&&(f=0)):38==e&&(f--,0>f&&(f=d.autocompleter.response.length-1)),d.autocompleterContain.find("ul").children().removeClass(d.opts.menuSelectedClass).eq(f).addClass(d.opts.menuSelectedClass)}else-1===b.inArray(e,d.autocompleter.ignoredKeyCod)?(d.autocompleter.timer&&(clearTimeout(d.autocompleter.timer),d.autocompleter.timer=null),d.autocompleter.timer=setTimeout(function(){d.autocompleter.search()},d.opts.deferTime)):(13===e&&(!d.autocompleterContain.hasClass(d.opts.hideAutocompleterClass)&&d.autocompleterContain.find("."+d.opts.menuSelectedClass).size()>0?(d.autocompleter.copyValueToSearch(),d.opts.callback.search(d.autocompleter.queryValue,d),d._this.blur()):d.opts.hasSearchButton?d.searchButton.trigger("click.search"):(d._this.blur(),d.opts.callback.search(d.autocompleter.queryValue,d))),d.opts.showLog&&console.log("禁用键"+e))},mousedown:function(){d.autocompleter.copyValueToSearch(b(this)),d.opts.callback.search(d.autocompleter.queryValue,d)},callback:function(){d._this.blur();var c=b.trim(d._this.val());""===c?d._this.focus():d.autocompleter.query(c,d.opts.data,d.opts.limitCount,d.opts.autocompleterIsAjax,!1,d.opts.callback.search)}},d.opts.autocompleter&&(d.autocompleter.bindEvent(),d.opts.hasSearchButton&&d.searchButton.off("click.search").on("click.search",function(){d.autocompleter.callback()})),d}}(window,jQuery);